**arlas-hits-exporter** docker image allows to export all the results of a given ARLAS-server search request as a JSON or CSV file. The image is able to manage UID/GID of generated JSON/CSV file.

The docker image is named `gisaia/arlas-hits-exporter`, and its version is contained in file [docker_image_version](../docker_image_version)

---

- [Build](#build)
- [Publication](#publication)
- [Usage](#usage)
  * [gisaia/arlas-hits-exporter Command line arguments](#gisaiaarlas-hits-exporter-Command-line-arguments)
  * [Example](#example)

<small><i><a href='http://ecotrust-canada.github.io/markdown-toc/'>Table of contents generated with markdown-toc</a></i></small>

# Build

```bash
arlas-hits-exporter/build.bash
```

# Publication

```bash
SIMULATE=false arlas-hits-exporter/publish.bash
```

# Usage

The image is to be used with the `docker run` command. Various `docker run` parameters can be used:

Parameter | Type | Description
-|-|-
`-e GROUP_ID=...` | Environment variable passed to the container | Passes a certain group ID to the docker container, so that the JSON/CSV file generated by the container is owned by that group. Often used with current group ID: `-e GROUP_ID="$(id -g)"`.
`-e USER_ID=...` | Environment variable passed to the container | Passes a certain user ID to the docker container, so that the JSON/CSV file generated  by the container is owned by that user. Often used with current user ID: `-e USER_ID="$(id -u)"`.
`--mount dst=/output,src=...,type=bind` | Directory bind-mount | Bind-mounts a directory from the host machine, where to output the generated JSON/CSV file. Its path is indicated by the `src=...` parameter. **Beware, the host directory has to be created in advance**.
| | Command line arguments | You can pass additional `arlas-hits-exporter` options, just by appending them at the end of the `docker run` command (after the name of the image). Example: `--format=csv`

## `gisaia/arlas-hits-exporter` Command line arguments

Argument | Description
-|-
`--search_url=...` | ARLAS-server search request (GET). Put the url between double or simple quotes.
`--include=...` | Comma separated field names/paths to include in the exported file.
`--format=...` | Export format : `json` or `csv`. (Default format is `json`)
`--sort_csv` | Columns of csv to sort on. For example add  `--sort_csv=-k1 -k2` to sort on the first and second columns

## Example

```bash
# Create output directory
mkdir -p data_as_csv

# Export all the postions that are within [11.545353459437365,57.10138822298879,11.585496447766673,57.124671359931796] as a CSV file
docker run \
  -e GROUP_ID="$(id -g)" \
  -e USER_ID="$(id -u)" \
  --mount dst=/output,src="$PWD/data_as_csv",type=bind \
  --rm \
  gisaia/arlas-hits-exporter \
    --search_url="http://host/arlas/explore/{collection}/_search?size=140&pwithin=11.545353459437365,57.10138822298879,11.585496447766673,57.124671359931796" \
    --include=field_to_export \
    --format=csv \
    --sort_csv=-k1
```
